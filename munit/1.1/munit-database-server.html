<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="munit, testing, unit testing">
  <link rel="canonical" href="https://ede65566-docs-migration.github.io/docs-site/munit/1.3/munit-database-server.html">
  <link rel="stylesheet" href="../../_theme/stylesheets/theme.css">
  <title>MUnit Database Server // MuleSoft Documentation</title>
</head>
<body class="article">
<header class="header" id="header" role="banner"><div class="header__wrapper clearfix">
      <div class="header__logo--primary-nav clearfix">
        <a href="https://docs.mulesoft.com" title="Home" rel="home" class="header__logo" id="logo">
          <img src="../../_theme/images/mulesoft-dev-logo.svg" alt="Home" class="header__logo-image"></a>
          <div class="header__region region region-header">
    <div id="block-system-main-menu" class="block block-menu first last odd" role="navigation">

        <h2 class="block__title block-title">Main Dev Menu</h2>
    
  <ul class="menu"><li class="menu__item is-expanded first expanded"><span class="menu__link">Platform</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/dev/anypoint-studio" title="" class="menu__link">Studio</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/connectors" title="" class="menu__link">Connectors</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/anypoint-exchange" title="" class="menu__link">Exchange</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/design-api" title="" class="menu__link">API Designer</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-developer-portal" title="" class="menu__link">API Portal</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/mule-runtime-engine" title="" class="menu__link">Mule runtime engine</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-management" title="" class="menu__link">API Manager</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/dev/reporting-api-analytics" title="" class="menu__link">API Analytics</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><span class="menu__link">Resources</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/getting-started/anypoint-platform" class="menu__link">Getting started</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/tutorials-and-howtos" class="menu__link">Tutorials &amp; HowTos</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/webinars-and-videos" title="" class="menu__link">Webinars &amp; Videos</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/workshops" class="menu__link">Online Workshops</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/integration-books-and-resources" class="menu__link">Books &amp; Whitepapers</a></li>
<li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/dev/" class="menu__link">Blog</a></li>
<li class="menu__item is-leaf leaf"><a href="https://docs.mulesoft.com" class="menu__link">Documentation</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://training.mulesoft.com" class="menu__link">Training</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><a href="https://developer.mulesoft.com/community" class="menu__link">Community</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="http://forum.mulesoft.org/" class="menu__link">Forums</a></li>
<li class="menu__item is-leaf leaf"><a href="https://meetups.mulesoft.com" class="menu__link">Meetups</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/" class="menu__link">Contributed Content</a></li>
<li class="menu__item is-leaf leaf"><a href="https://s2.developer.mulesoft.com/jobs.html" class="menu__link">Jobs</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.mulesoft.org/jira/browse/MULE" class="menu__link">Issue tracker</a></li>
</ul></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/champions" class="menu__link">Champions</a></li>
</ul></div>
  </div>
      </div> <!-- header__logo--primary-nav -->
      <div class="header__top-wrapper">
        <div class="header__nav-wrapper">
                      <div class="region region-header-top">
    <div id="block-search-form" class="block block-search first last odd" role="search">

      
  
</div>
  </div>
        </div>
        <div class="top-nav-ctas">
          <a class="icon-muletheme-phone" href="https://mulesoft.com/lp/contact" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-contact');"></a>
          <a href="https://anypoint.mulesoft.com/login/#/signup?apintent=dmc_generic" class="try" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-nav');">Try now</a>
          <a href="https://mulesoft.com/" class="dev" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-mscom');">MuleSoft.com</a>
        </div>
      </div> <!-- header__secondary-nav-search -->
    </div> <!-- header__wrapper -->
    <a href="#sidr" id="open-left" class="closed">
    </a>
  </header><main role="main" class="main-wrapper">
  <div class="navigation-wrapper">
    <nav role="navigation" class="navigation">
      <div class="search">
        <input type="text" placeholder="Search the docs" class="search-input" autocomplete="off" autocorrect="off" autocapitalize="off">
      </div>
      <div class="inner-nav">
          <ul class="nav-lst">
              <li class="nav-itm" data-depth="0" data-state="collapsed">
                  <button class="nav-tgl"></button>
                <a class="nav-lnk" href="index.html">MUnit</a>
                  <ul class="nav-lst">
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="using-munit-in-anypoint-studio.html">Using MUnit in Anypoint Studio</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-suite.html">MUnit Suite</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="mock-message-processor.html">Mock Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="verify-message-processor.html">Verify Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="set-message-processor.html">Set Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="spy-message-processor.html">Spy Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="assertion-message-processor.html">Assertion Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-matchers.html">MUnit Matchers</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-database-server.html">MUnit Database Server</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-ftp-server.html">MUnit FTP Server</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-maven-support.html">MUnit Maven Support</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-short-tutorial.html">MUnit Short Tutorial</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="example-testing-apikit.html">Example: Testing APIKit</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="logging-in-munit.html">Logging in MUnit</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="run-and-wait-scope.html">Run and Wait Scope</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-tests-with-java.html">MUnit Tests With Java</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="../../solutions/migration/munit/1.1-migration-guide.html">MUnit 1.1 Migration Guide</a>
                      </li>
                  </ul>
              </li>
          </ul>
      </div>
    </nav>
  </div>
  <article class="primary-content">
    <header class="article-header">
      <div class="breadcrumb">
        <strong class="breadcrumb-item">[ Domain Selector Placeholder ]</strong> /
        <span class="breadcrumb-item">MUnit Database Server</span>
      </div>
      <div class="edit-on-github">
        <a href="https://github.com/ede65566-docs-migration/munit-docs/edit/v1.1/modules/ROOT/content/munit-database-server.adoc" class="edit-on-github-link">Edit on Github</a>
      </div>
    </header>
    <h1>MUnit Database Server</h1>
    <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the main problems of testing production code are external system connections. If we create a test of a piece of code that connects with a database server, we need to install a DB server in our local environment in order to run the tests. Another option is to have an external DB server for testing only, but the major problem with this approach is that our Maven project would not be portable&#8201;&#8212;&#8201;we could not send it to a third party because they would not be able to compile it without installing the DB server first.</p>
</div>
<div class="paragraph">
<p>To enable you to avoid this issue, MUnit allows you to implement a database server in your local environment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-test-using-munit-db-server"><a class="anchor" href="#creating-a-test-using-munit-db-server"></a>Creating a Test Using MUnit DB Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the purpose of this documentation we are going to assume we are testing the following Mule code:</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/testdbflow.png" alt="testdbflow">
</div>
</div>
<h3 id="xml-or-standalone-editor" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Set Up a default Java Data Base Connection  --&gt;
&lt;spring:beans&gt;
        &lt;spring:bean id="jdbcDataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource"&gt;
            &lt;spring:property name="driverClass" value="${db.driver}"/&gt;
            &lt;spring:property name="url" value="${db.url}"/&gt;
            &lt;spring:property name="username" value="${db.user}"/&gt;
            &lt;spring:property name="password" value="${db.password}"/&gt;
        &lt;/spring:bean&gt;
    &lt;/spring:beans&gt;

&lt;!-- Configure your DB connector referencing your JDBC specs --&gt;
    &lt;db:generic-config name="Generic_Database_Configuration"  doc:name="Generic Database Configuration" dataSource-ref="jdbcDataSource"/&gt;

    &lt;flow name="testDbFlow"&gt;
        &lt;!-- Perform a query based on a value passed by a flow variable --&gt;
        &lt;db:select config-ref="Generic_Database_Configuration" doc:name="Database" &gt;
            &lt;db:parameterized-query&gt;&lt;![CDATA[SELECT * FROM jobtitlelookup WHERE jobtitleid = #[variable:jobid]]]&gt;&lt;/db:parameterized-query&gt;
        &lt;/db:select&gt;

        &lt;!-- Set two conditions depending on the query result --&gt;
        &lt;choice doc:name="Choice"&gt;
            &lt;!-- If there is one or more values resulting from the query set those values as the payload --&gt;
            &lt;when expression="#[payload.size()&gt;0]"&gt;
                &lt;set-payload value="#[payload[0].get('jobtitle')]" doc:name="Set Payload if True"&gt;&lt;/set-payload&gt;
            &lt;/when&gt;
            &lt;!-- If the query throws no results, inform it in the payload  --&gt;
            &lt;otherwise&gt;
                &lt;set-payload value="No job title for #[flowVars.jobid] was found" doc:name="Set Payload if False"&gt;&lt;/set-payload&gt;
            &lt;/otherwise&gt;
        &lt;/choice&gt;

        &lt;!-- Finally, pass the payload content as a Flow variable  --&gt;
        &lt;set-variable value="#[payload]" variableName="job" doc:name="Variable"&gt;&lt;/set-variable&gt;
    &lt;/flow&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We need to create a test that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Contains a Database Server with a <code>jobtitlelookup</code> table.</p>
</li>
<li>
<p>Provides a valid Database Structure for the Database connector to perform its' query.</p>
</li>
<li>
<p>Passes a value for the <code>jobid</code> variable that the Database connector uses</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This page assumes that you have <code>&lt;munit.version&gt;&lt;/munit.version&gt;</code> property defined in your <code>pom.xml</code>.</p>
</div>
<div class="paragraph">
<p>When running from Maven, you need to add the MUnit DB server artifact to your <code>pom</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- dbserver Dependency --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.mulesoft.munit.utils&lt;/groupId&gt;
	&lt;artifactId&gt;munit-dbserver-module&lt;/artifactId&gt;
	&lt;version&gt;${munit.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also this code example uses Spring for the Database configuration. When running from Maven, you should add Spring&#8217;s dependencies to your <code>pom.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Spring Dependency --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
  &lt;version&gt;4.1.6.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="defining-the-munit-db-server"><a class="anchor" href="#defining-the-munit-db-server"></a>Defining The MUnit DB Server</h3>
<div class="paragraph">
<p>Define the DataBase server using the <code>DB Server</code> connector from the <code>MUnit Integration Test Tools</code> in your Mule Pallet.<br>
The DB Server can take the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the configuration name of this DB server. Must be unique.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>database</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the name of the in-memory DB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sqlFile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the path of the SQL file that defines the DB structure/contents. This parameter is used to create the DB at startup. Find out more about this in the <a href="#defining-the-db-structure-from-an-sql-file">Defining the DB Structure from an SQL File</a> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>csv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the path of the-comma separated file used to define the DB structure/contents. This parameter is used to create the DB at startup. Find out more about this in the <a href="#defining-the-db-structure-from-a-csv-file">Defining the DB Structure from a CSV File</a> section.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For this example we define the DB structure and content using a .csv file.</p>
</div>
<div class="paragraph">
<p>Create a file named <code>jobtitlelookup.csv</code> containing the following values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">JOBTITLE,EECSALARYORHOURLY,JOBTITLEID
Developer,10,DEV</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order for this csv file to be visible within your project, make sure you locate it in the <code>src/test/resources</code> directory from your application.</p>
</div>
<div class="paragraph">
<p>Proceed to define your DB Server configuration in a new <a href="munit-suite.html">MUnit Suite</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;munit:config mock-inbounds="false" mock-connectors="false"/&gt;   <i class="conum" data-value="1"></i><b>(1)</b>

&lt;dbserver:config  name="DB_Server" database="DATABASE_NAME"  doc:name="DBServerConfig" csv="jobtitlelookup.csv" /&gt;    <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines MUnit configuration. Notice that <code>mock-connectors</code> is set to <code>false</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Defines the DB server configuration.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="db-server-connection-parameters"><a class="anchor" href="#db-server-connection-parameters"></a>DB Server Connection Parameters</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The MUnit DB server has the following default set of connection parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">db.driver=org.h2.Driver
db.url=jdbc:h2:mem:DATABASE_NAME;MODE=MySQL
db.user=
db.password=</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The values of the <code>db.user</code> and <code>db.password</code> parameters are intentionally blank.</p>
</div>
</div>
<div class="sect3">
<h4 id="defining-the-db-structure"><a class="anchor" href="#defining-the-db-structure"></a>Defining the DB Structure</h4>
<div class="paragraph">
<p>There are two different ways to define the structure and content of your database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SQL</p>
</li>
<li>
<p>CSV</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The MUnit DB server is based on <a href="http://www.h2database.com/html/main.html">H2</a>. Complex structures, index and join commands may not work properly.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="defining-the-db-structure-from-an-sql-file"><a class="anchor" href="#defining-the-db-structure-from-an-sql-file"></a>Defining the DB Structure from an SQL File</h5>
<div class="paragraph">
<p>To define you DB structure and content from an SQL file,  provide a valid set of ANSI SQL DDL (Data Definition Language) instructions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dbserver:config  name="DB_Server" database="DATABASE_NAME" sqlFile="FILE_NAME.sql" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="defining-the-db-structure-from-a-csv-file"><a class="anchor" href="#defining-the-db-structure-from-a-csv-file"></a>Defining the DB Structure from a CSV File</h5>
<div class="paragraph">
<p>You can create your DB from CSV files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the table is the name of the file (in the example below, <code>customers</code>).</p>
</li>
<li>
<p>The name of the columns are the headers of your CSV file.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dbserver:config name="DB_Server" database="DATABASE_NAME" csv="FILE_NAME.csv"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also split your DB structure among several CSV files. In this case, include the file names as a list separated by a semicolon, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dbserver:config name="DB_Server" database="DATABASE_NAME" csv="FILE_NAME.csv;FILE_NAME_1.csv"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates two tables <code>FILE_NAME</code> and <code>FILE_NAME_1</code></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="starting-the-munit-db-server"><a class="anchor" href="#starting-the-munit-db-server"></a>Starting The MUnit DB Server</h3>
<div class="paragraph">
<p>In order for it to run, the database server must be started in a <a href="munit-suite.html#defining-a-before-suite">before-suite</a>. You start the server using the <code>start-db-server</code> message processor.</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor-2" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/before-suite-start-dbserver.png" alt="before suite start dbserver">
</div>
</div>
<h3 id="xml-or-standalone-editor-2" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;munit:before-suite name="beforesuite" description="Starting DB server"&gt;
    &lt;dbserver:start-db-server config-ref="DB_Server" doc:name="startServer"/&gt;
&lt;/munit:before-suite&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running from Maven and are getting a <code>java.lang.ClassNotFoundException: org.h2.Driver</code>, you might need to add the H2 artifact to your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- H2 Dependency --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.h2database&lt;/groupId&gt;
	&lt;artifactId&gt;h2&lt;/artifactId&gt;
	&lt;version&gt;1.3.176&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are getting this exception and you are not using Maven, you need to add the <code>h2-v.sv.vvv.jar</code> file to your project&#8217;s build path. To do this:
. Download the .jar file from the project&#8217;s website
. From Studio, right click in your project&#8217;s folder, and go to <strong>Properties</strong>
. Go to <strong>Java Build Path</strong>, <strong>Libraries</strong> and <strong>Add External JARs&#8230;&#8203;</strong>
. Navigate to where you downloaded the .jar file and select it.</p>
</div>
<div class="paragraph">
<p>This adds h2 libraries to your build path allowing your project to use the org.h2.Driver class</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="running-the-test"><a class="anchor" href="#running-the-test"></a>Running The Test</h3>
<div class="paragraph">
<p>Once our DB server is up and running we can run our test.</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor-3" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/run-first-test.png" alt="run first test">
</div>
</div>
<h3 id="xml-or-standalone-editor-3" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;munit:test name="test-suite-testDbFlowTest" description="Asserts the payload after running the project"&gt;

            &lt;!-- Passes a variable to value to run in the main flow. --&gt;
            &lt;set-variable variableName="jobid" value="DEV" doc:name="Variable"/&gt;

            &lt;!-- Run the production code. --&gt;
            &lt;flow-ref name="testDbFlow" doc:name="testDbFlow"/&gt;

            &lt;!-- Asserts the payload returned by the production code. This value comes from our in-memory database. --&gt;
            &lt;munit:assert-on-equals expectedValue="Developer" actualValue="#[flowVars['job']]" doc:name="Assert Equals"/&gt;
&lt;/munit:test&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>We are not using any new message processor, since the database has already been initialized and loaded with the proper data.
We are just validating that the query ran in our production code is correct, and that the payload returned is the expected one.</p>
</div>
</div>
<div class="sect2">
<h3 id="stopping-the-munit-db-server"><a class="anchor" href="#stopping-the-munit-db-server"></a>Stopping The MUnit DB Server</h3>
<div class="paragraph">
<p>To stop the DB server gracefully, it needs to be stopped in an <a href="munit-suite.html#defining-an-after-suite">After Suite</a>, using a <code>db-server</code> message processor with the <code>Stop db server</code> operation.</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor-4" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/after-suite-stop-dbserver.png" alt="after suite stop dbserver">
</div>
</div>
<h3 id="xml-or-standalone-editor-4" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Stop the server --&gt;
&lt;munit:after-suite name="munit3Flow-test-suiteAfter_Suite" description="Ater suite actions"&gt;
   &lt;dbserver:stop-db-server config-ref="DB_Server" doc:name="stopServer"/&gt;
&lt;/munit:after-suite&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="other-munit-db-server-message-processors"><a class="anchor" href="#other-munit-db-server-message-processors"></a>Other MUnit DB server Message Processors</h3>
<div class="paragraph">
<p>The MUnit DB server also offers a few other features, outlined in this section.</p>
</div>
<div class="sect3">
<h4 id="validating-sql-query-results"><a class="anchor" href="#validating-sql-query-results"></a>Validating SQL Query Results</h4>
<div class="paragraph">
<p>The MUnit DB Server allows you to validate that the results of a query are as expected.</p>
</div>
<div class="paragraph">
<p>To do this, you use the <code>validate-that</code> operation. Set the <code>results</code> property to CSV with rows separated by a newline character (<code>\n</code>), as shown below.</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor-5" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/db-server-validate-that-operation.png" alt="db server validate that operation">
</div>
</div>
<h3 id="xml-or-standalone-editor-5" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;munit:test name="test-suite-testDbFlowAssertQuery" description="Check if a specific query returns the expected value"&gt;
     &lt;dbserver:validate-that config-ref="DB_Server"
query="SELECT * FROM jobtitlelookup WHERE JOBTITLE='Developer';" returns="&amp;quot;JOBTITLE&amp;quot;,&amp;quot;EECSALARYORHOURLY&amp;quot;,&amp;quot;JOBTITLEID&amp;quot;\n&amp;quot;Developer&amp;quot;,&amp;quot;10&amp;quot;,&amp;quot;DEV&amp;quot;" doc:name="validateQuery"/&gt;
&lt;/munit:test&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The result should be a CSV text. In order to be able to see it as the payload, MUnit DBserver uses OpenCSV libraries</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running from Maven and are getting a <code>java.lang.NoClassDefFoundError</code> exception, you might need to add the Opencsv artifact to your <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- openCSV Dependency --&gt;
&lt;dependency&gt;
	&lt;groupId&gt;net.sf.opencsv&lt;/groupId&gt;
	&lt;artifactId&gt;opencsv&lt;/artifactId&gt;
	&lt;version&gt;2.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are getting this exception and you are not using Maven, you need to add the <code>opencsv-v.v.jar</code> file to your project&#8217;s build path. To do this:
. Download the .jar file from the project&#8217;s website
. From Studio, right click in your project&#8217;s folder, and go to <strong>Properties</strong>
. Go to <strong>Java Build Path</strong>, <strong>Libraries</strong> and <strong>Add External JARs&#8230;&#8203;</strong>
. Navigate to where you downloaded the .jar file and select it.</p>
</div>
<div class="paragraph">
<p>This adds open csv libraries to your build path allowing your project to properly render the csv into your payload.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="executing-sql-instructions-and-sql-queries"><a class="anchor" href="#executing-sql-instructions-and-sql-queries"></a>Executing SQL instructions and SQL Queries</h4>
<div class="paragraph">
<p>The MUnit DB Server allows you to execute instructions on the in-memory databases, so
you can add or remove registries before a test, and also check if your data was
stored correctly.</p>
</div>
<div class="paragraph">
<p>Use a DB Server connector with the <code>execute</code> operation to insert the values new values to the table (<code>Culinary Team Member,10,HIR</code>), then use another DB Server connector with an <code>execute query</code> operation to retrieve all values from the table (including the newly added ones) and check the payload using a logger component to store the payload.</p>
</div>
<div class="exampleblock ex">
<div class="content">
<h3 id="studio-visual-editor-6" class="discrete view">Studio Visual Editor</h3>
<div class="imageblock">
<div class="content">
<img src="./_images/test-suite-execute.png" alt="test suite execute">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./_images/test-suite-execute-query.png" alt="test suite execute query">
</div>
</div>
<h3 id="xml-or-standalone-editor-6" class="discrete view">XML or Standalone Editor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;munit:test name="test-suite-testDbFlowExecuteQuery" description="Execute a query from the DB connector"&gt;

	&lt;!-- Execute a SQL instruction using the execute operation --&gt;
	&lt;dbserver:execute config-ref="DB_Server" doc:name="Execute" sql="INSERT INTO jobtitlelookup VALUES ('Culinary Team Member','10','HIR');"/&gt;

	&lt;!-- Check the update using execute-query operation --&gt;
	&lt;dbserver:execute-query config-ref="DB_Server" sql="SELECT * FROM jobtitlelookup" doc:name="Check by Executing a Query"/&gt;

	&lt;!-- log the resulting payload --&gt;
	&lt;logger message="#[payload]" level="INFO" doc:name="Logger"/&gt;
&lt;/munit:test&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The logger in your console should read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[main] org.mule.api.processor.LoggerMessageProcessor: [{JOBTITLEID=DEV, EECSALARYORHOURLY=10, JOBTITLE=Developer}, {JOBTITLEID=HIR, EECSALARYORHOURLY=10, JOBTITLE=Culinary Team Member}]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-environments"><a class="anchor" href="#execution-environments"></a>Execution Environments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may have noticed that our production code example makes extensive use of placeholders for certain parameters, such as <code>driverName</code>, <code>url</code> etc. in the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;spring:bean id="jdbcDataSource" class="org.enhydra.jdbc.standard.StandardDataSource" destroy-method="shutdown"&gt;
  &lt;spring:property name="driverName" value="${db.driver}" /&gt;
  &lt;spring:property name="url" value="${db.url}" /&gt;
  &lt;spring:property name="user" value="${db.user}" /&gt;
  &lt;spring:property name="password" value="${db.password}" /&gt;
&lt;/spring:bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason for this is that properties allow us to create code that is more configurable. Compare the example above with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;spring:bean id="jdbcDataSource" class="org.enhydra.jdbc.standard.StandardDataSource" destroy-method="shutdown"&gt;
  &lt;spring:property name="driverName" value="org.mule.fake.Driver" /&gt;
  &lt;spring:property name="url" value="192.168.0.3" /&gt;
  &lt;spring:property name="user" value="myUser" /&gt;
  &lt;spring:property name="password" value="123456" /&gt;
&lt;/spring:bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second example code is untestable, even without MUnit. If we need to test this code before going to production, we always hit the production DB server with our real credentials, which entails risk.</p>
</div>
<div class="paragraph">
<p>On the other hand, the first example code allows us to define two different property files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One for the testing environment</p>
</li>
<li>
<p>One for the production environment</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is use in combination with the Mule property placeholder, shown below with <code>${env}</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;global-property value="mule.${env}.property"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, the use of <code>${env}</code> allows us to leverage execution environments. So for example we can define two separate properties files, <code>mule.test.properties</code> and <code>mule.prod.properties</code>, containing the same properties with values according to the environment we wish to use.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To run your test from Maven and issue the env parameter from the command line, you can run: <code>mvn -DargLine="-Dmule.env=test" clean test</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
  </article>
</main>
<footer class="footer"><div class="footer__wrapper">
      <div class="footer__top">
              </div>
      <div class="footer-bottom-wrapper">
        <!--<a href="/" title="Home" rel="home" class="header__logo" id="logo"><img src="/sites/all/themes/muletheme/images/mule_logo.svg" alt="Home" class="header__logo-image" /></a>-->
        <div class="connect-footer">
          <p>Sign up for our Dev newsletter</p>
          <div class="connect-footer">

</div>
  </div>
        <div class="terms-conditions temp">
          <div id="block-menu-menu-footer-bottom-menu" class="block block-menu contextual-links-region first last odd" role="navigation">
            <ul class="menu"><li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/" class="menu__link">MuleSoft.com</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/" class="menu__link">Blog</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/content/terms-service" class="menu__link">Terms</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/privacy-policy" class="menu__link">Privacy</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/contact" class="menu__link">Contact</a></li>
            </ul></div>
                    <div class="default-terms-conditions">
          </div>
          MuleSoft provides a widely used <a href="https://www.mulesoft.com/platform/enterprise-integration">integration platform</a> for connecting SaaS and enterprise applications in the cloud and on-premise. Delivered as a unified integration experience, <a href="https://www.mulesoft.com/platform/saas/cloudhub-ipaas-cloud-based-integration">CloudHub&trade;</a> and <a href="https://www.mulesoft.com/platform/soa/mule-esb-open-source-esb">Mule ESB&trade;</a> (Enterprise Service Bus) are built on proven open source technology for fast and reliable on-premise and cloud integration without vendor lock-in.


        </div>
      </div>
      <div class="footer-end">
        <div class="footer-logo-wrapper">
          <a href="https://developer.mulesoft.com/" class="footer-logo"></a>
        </div>
        <ul class="social-links"><li><a href="https://www.mulesoft.com/lp/contact" target="_blank" class="icon-muletheme-phone"></a></li>
          <li><a href="https://www.linkedin.com/company/mulesoft" target="_blank" class="icon-muletheme-linkedin"></a></li>
          <li><a href="https://twitter.com/muledev" target="_blank" class="icon-muletheme-twitter"></a></li>
          <li><a href="https://www.facebook.com/MuleSoft" target="_blank" class="icon-muletheme-facebook"></a></li>
          <li><a href="mailto:info@mulesoft.com" target="_blank" class="icon-muletheme-email"></a></li>
          <li><a href="https://videos.mulesoft.com/" target="_blank" class="icon-muletheme-youtube"></a></li>
        </ul><p class="copyright"><span>&copy;2017</span> MuleSoft, INC.</p>
      </div>
    </div>
    </footer><script src="../../_theme/scripts/menu.js"></script>
<script src="../../_theme/scripts/highlight.pack.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
