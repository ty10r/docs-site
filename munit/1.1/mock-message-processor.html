<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="munit, testing, unit testing">
  <link rel="canonical" href="https://ede65566-docs-migration.github.io/docs-site/munit/1.3/mock-message-processor.html">
  <link rel="stylesheet" href="../../_theme/stylesheets/theme.css">
  <title>Mock Message Processor // MuleSoft Documentation</title>
</head>
<body class="article">
<header class="header" id="header" role="banner"><div class="header__wrapper clearfix">
      <div class="header__logo--primary-nav clearfix">
        <a href="https://docs.mulesoft.com" title="Home" rel="home" class="header__logo" id="logo">
          <img src="../../_theme/images/mulesoft-dev-logo.svg" alt="Home" class="header__logo-image"></a>
          <div class="header__region region region-header">
    <div id="block-system-main-menu" class="block block-menu first last odd" role="navigation">

        <h2 class="block__title block-title">Main Dev Menu</h2>
    
  <ul class="menu"><li class="menu__item is-expanded first expanded"><span class="menu__link">Platform</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/dev/anypoint-studio" title="" class="menu__link">Studio</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/connectors" title="" class="menu__link">Connectors</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/anypoint-exchange" title="" class="menu__link">Exchange</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/design-api" title="" class="menu__link">API Designer</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-developer-portal" title="" class="menu__link">API Portal</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/mule-runtime-engine" title="" class="menu__link">Mule runtime engine</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-management" title="" class="menu__link">API Manager</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/dev/reporting-api-analytics" title="" class="menu__link">API Analytics</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><span class="menu__link">Resources</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/getting-started/anypoint-platform" class="menu__link">Getting started</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/tutorials-and-howtos" class="menu__link">Tutorials &amp; HowTos</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/webinars-and-videos" title="" class="menu__link">Webinars &amp; Videos</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/workshops" class="menu__link">Online Workshops</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/integration-books-and-resources" class="menu__link">Books &amp; Whitepapers</a></li>
<li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/dev/" class="menu__link">Blog</a></li>
<li class="menu__item is-leaf leaf"><a href="https://docs.mulesoft.com" class="menu__link">Documentation</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://training.mulesoft.com" class="menu__link">Training</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><a href="https://developer.mulesoft.com/community" class="menu__link">Community</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="http://forum.mulesoft.org/" class="menu__link">Forums</a></li>
<li class="menu__item is-leaf leaf"><a href="https://meetups.mulesoft.com" class="menu__link">Meetups</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/" class="menu__link">Contributed Content</a></li>
<li class="menu__item is-leaf leaf"><a href="https://s2.developer.mulesoft.com/jobs.html" class="menu__link">Jobs</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.mulesoft.org/jira/browse/MULE" class="menu__link">Issue tracker</a></li>
</ul></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/champions" class="menu__link">Champions</a></li>
</ul></div>
  </div>
      </div> <!-- header__logo--primary-nav -->
      <div class="header__top-wrapper">
        <div class="header__nav-wrapper">
                      <div class="region region-header-top">
    <div id="block-search-form" class="block block-search first last odd" role="search">

      
  
</div>
  </div>
        </div>
        <div class="top-nav-ctas">
          <a class="icon-muletheme-phone" href="https://mulesoft.com/lp/contact" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-contact');"></a>
          <a href="https://anypoint.mulesoft.com/login/#/signup?apintent=dmc_generic" class="try" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-nav');">Try now</a>
          <a href="https://mulesoft.com/" class="dev" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-mscom');">MuleSoft.com</a>
        </div>
      </div> <!-- header__secondary-nav-search -->
    </div> <!-- header__wrapper -->
    <a href="#sidr" id="open-left" class="closed">
    </a>
  </header><main role="main" class="main-wrapper">
  <div class="navigation-wrapper">
    <nav role="navigation" class="navigation">
      <div class="search">
        <input type="text" placeholder="Search the docs" class="search-input" autocomplete="off" autocorrect="off" autocapitalize="off">
      </div>
      <div class="inner-nav">
          <ul class="nav-lst">
              <li class="nav-itm" data-depth="0" data-state="collapsed">
                  <button class="nav-tgl"></button>
                <a class="nav-lnk" href="index.html">MUnit</a>
                  <ul class="nav-lst">
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="using-munit-in-anypoint-studio.html">Using MUnit in Anypoint Studio</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-suite.html">MUnit Suite</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="mock-message-processor.html">Mock Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="verify-message-processor.html">Verify Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="set-message-processor.html">Set Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="spy-message-processor.html">Spy Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="assertion-message-processor.html">Assertion Message Processor</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-matchers.html">MUnit Matchers</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-database-server.html">MUnit Database Server</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-ftp-server.html">MUnit FTP Server</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-maven-support.html">MUnit Maven Support</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-short-tutorial.html">MUnit Short Tutorial</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="example-testing-apikit.html">Example: Testing APIKit</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="logging-in-munit.html">Logging in MUnit</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="run-and-wait-scope.html">Run and Wait Scope</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="munit-tests-with-java.html">MUnit Tests With Java</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="../../solutions/migration/munit/1.1-migration-guide.html">MUnit 1.1 Migration Guide</a>
                      </li>
                  </ul>
              </li>
          </ul>
      </div>
    </nav>
  </div>
  <article class="primary-content">
    <header class="article-header">
      <div class="breadcrumb">
        <strong class="breadcrumb-item">[ Domain Selector Placeholder ]</strong> /
        <span class="breadcrumb-item">Mock Message Processor</span>
      </div>
      <div class="edit-on-github">
        <a href="https://github.com/ede65566-docs-migration/munit-docs/edit/v1.1/modules/ROOT/content/mock-message-processor.adoc" class="edit-on-github-link">Edit on Github</a>
      </div>
    </header>
    <h1>Mock Message Processor</h1>
    <div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Mock</strong> feature provided by MUnit allows you to define <em>mocked</em> behavior for a message processor. In this case, MUnit replaces the normal behavior of the message processor with the behavior you define. Thus you can modify how a specific message processor responds when it is called with a particular set of attributes.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-mocks"><a class="anchor" href="#defining-mocks"></a>Defining Mocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Defining a mock entails several tasks, listed in the sections below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#define">Defining the Message Processor to Mock</a></p>
</li>
<li>
<p><a href="#matchers">Defining Mocked Behavior Using Message Processor Attributes</a></p>
</li>
<li>
<p><a href="#def_payload">Defining the Payload of the Mock Response</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the parameters entailed in the above tasks, you can tell MUnit how to replace the normal behavior of the message processor with the one you define.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is not possible to mock flow control message processors, such as Filter or Choice.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the purpose of this documentation, we assume we are testing the following Mule code:</p>
</div>
<div class="listingblock">
<div class="title">Test code</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;flow name="exampleFlow"&gt;
  &lt;set-payload value="#['real_payload']" doc:name="Real Set Payload"/&gt;
&lt;/flow&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="define"><a class="anchor" href="#define"></a>Defining the Message Processor to Mock</h3>
<div class="paragraph">
<p>When defining a mock, we make use of the <code>when</code> message processor, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;

&lt;/mock:when&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>messageProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which message processor to mock. The definition takes the form <code>{name-space}:{message-processor-name}</code>. Regular expressions are allowed.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>messageProcessor</code> attribute accepts regular expressions. For example, you can create a mock as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor=".*:set-payload"&gt;

&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above defines a mock for a message processor named <code>set-payload</code>, disregarding which namespace the message processor belongs to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The regular expression language is the same as Java.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matchers"><a class="anchor" href="#matchers"></a>Defining Mocked Behavior Using Message Processor Attributes</h3>
<div class="paragraph">
<p>A mock definition is based on <em>matchers</em>, that is, parameters that match features of the desired message processor. Defining a mock solely on the name of the message processor largely limits your scope and actions regarding the mock. For this reason, MUnit allows you to define a mock by defining matchers over the value of a message processor&#8217;s attributes.</p>
</div>
<div class="listingblock">
<div class="title">Defining a mock by attributes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define as many attributes as you deem necessary to make the mock as representative as possible. When defining an attribute, you do so by defining:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the attribute. This value is literal, it doesn&#8217;t support regular expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>whereValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The value that the attribute of the real message processor should contain. It accepts MEL expressions. If left as a literal, it assumes a string value.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
MUnit allows you to define mocks based on the content of the Mule message.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the attribute you wish to use when mocking is similar to <code>config-ref</code> and resolves to an actual bean, you can use the MUnit MEL function <code>getBeanFromMuleContext('bean_name')</code>. This function inspects the Mule registry and returns the bean with the matching name if present. See <a href="assertion-message-processor.html">Assertion Message Processor</a> for details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Several attributes in Mule&#8217;s message processors support expressions, which are evaluated at runtime. MUnit is smart enough to understand this.</p>
</div>
<div class="paragraph">
<p>Suppose we change the test code to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;flow name="exampleFlow"&gt;
  &lt;set-variable variableName="#[1==1? 'var_true': 'var_false']"
    value="#['some value']" doc:name="Variable"/&gt;
  &lt;set-variable variableName="#[1==2? 'var_true': 'var_false']"
    value="#['some value']" doc:name="Variable"/&gt;
&lt;/flow&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are going to mock <em>only</em> the first <code>set-variable</code>. To specify this, we use <em>attributes</em>, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-variable"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['var_true']" name="variableName"/&gt;
  &lt;/mock:with-attributes&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="a-word-about-mocking-flow-ref"><a class="anchor" href="#a-word-about-mocking-flow-ref"></a>A Word About Mocking Flow-ref</h3>
<div class="paragraph">
<p>In MUnit, you don&#8217;t mock or verify a <code>flow-ref</code> message processor, but the flow or sub-flow that would be invoked by <code>flow-ref</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:sub-flow"&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that neither <code>flow</code> or <code>sub-flow</code> have the attribute <code>doc:name</code>; the attribute <code>name</code> is used instead. So, to mock a <code>flow-ref</code> to a <code>flow</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:flow"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="FlowName" name="name"/&gt;
  &lt;/mock:with-attributes&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, note that to mock a <code>sub-flow</code> you can&#8217;t just type the name of the <code>sub-flow</code>. Instead, you need to use the MUnit matcher <code>matchContains</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:sub-flow"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#[matchContains('Sub_Flow_name')]" name="name"/&gt;
  &lt;/mock:with-attributes&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-mel hljs" data-lang="mel">#[matchContains('exampleSub_Flow1')]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>matchContains</code> is not necessary when verifying or mocking flows, only sub-flows.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When mocking or verifying a sub-flow and using the <code>name</code> attribute, always use the MUnit matcher <code>matchContains</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="def_payload"><a class="anchor" href="#def_payload"></a>Defining the Payload of the Mock Response</h3>
<div class="paragraph">
<p>When mocking a message processor, you can define the Mule message that the mocked message processor should return.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
  &lt;mock:then-return payload="#['mocked_payload']"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the message response.</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>payload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the contents of the mocked payload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encoding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the encoding of the message. This attribute is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the MIME type of the message. This attribute is optional.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="returning-the-original-payload"><a class="anchor" href="#returning-the-original-payload"></a>Returning the Original Payload</h4>
<div class="paragraph">
<p>If you don&#8217;t want to mock the payload of the message processor and want to return
the original payload, you can use the function <code>samePayload()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
  &lt;mock:then-return payload="#[samePayload()]"/&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the same payload</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Omitting the <code>mock:then-return</code> property also returns the original payload
but if you want to return the original payload and mock message properties you can use the
<code>samePayload</code> function to achieve this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
  &lt;mock:then-return payload="#[samePayload()]"&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;mock:inbound-properties&gt;
      &lt;mock:inbound-property key="property" value="#['propertyValue']"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    &lt;/mock:inbound-properties&gt;
  &lt;/mock:then-return&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the same payload</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mock message property</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="loading-payloads-from-files-and-scripts"><a class="anchor" href="#loading-payloads-from-files-and-scripts"></a>Loading Payloads From Files and Scripts</h4>
<div class="paragraph">
<p>Sometimes it&#8217;s easier to load complex payloads from a file. MUnit offers a set of MEL functions to help you achieve this.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function Name</th>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getResource()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of a <em>classpath</em> resource.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loads a resource from the project&#8217;s classpath and returns an MuniResource object. This object supports util methods such as: <code>asStream()</code> , <code>asString()</code> and <code>asByteArray()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resultOfScript()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of a declared script bean.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes a script that is registered in the application, either in the MUnit suite or in one of the imported files.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example: getResource</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:then-return payload="#[getResource('users.xml').asStream()]"/&gt;    <i class="conum" data-value="1"></i><b>(1)</b>
&lt;mock:then-return payload="#[getResource('users.xml').asString()]"/&gt;    <i class="conum" data-value="2"></i><b>(2)</b>
&lt;mock:then-return payload="#[getResource('users.xml').asByteArray()]"/&gt; <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Return the content of <code>users.xml</code> as an input stream.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return the content of <code>users.xml</code> as a string.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Return the content of <code>users.xml</code> as a byte array.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example: resultOfScript</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;script:script name="groovyScriptPayloadGenerator" engine="groovy"&gt;&lt;![CDATA[  <i class="conum" data-value="1"></i><b>(1)</b>
  List&lt;String&gt; lists = new ArrayList&lt;String&gt;();
  lists.add("item1");
  lists.add("item2");
  lists.add("item3");

  return lists;]]&gt;
&lt;/script:script&gt;

  ...
&lt;mock:then-return payload="#[resultOfScript('groovyScriptPayloadGenerator')]"/&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Script definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Return mock payload as the result of the <code>groovyScriptPayloadGenerator</code> script.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="defining-the-properties-of-a-mock-response"><a class="anchor" href="#defining-the-properties-of-a-mock-response"></a>Defining the Properties of a Mock Response</h3>
<div class="paragraph">
<p>With MUnit you can also define the properties of the message to be returned by a mock. The following code expands on the example <a href="#def_payload">above</a> to modify the returned payload:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:when messageProcessor="mule:set-payload"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
  &lt;mock:then-return payload="#['mocked_payload']"&gt;
    &lt;mock:invocation-properties&gt;
      &lt;mock:invocation-property key="property_name" value="#['property_value']"/&gt;
    &lt;/mock:invocation-properties&gt;
  &lt;/mock:then-return&gt;
&lt;/mock:when&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the property. This value is always literal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the value the property should contain. It accepts MEL expressions. If left as a literal, it assumes a string value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>encoding</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the encoding of the message. This attribute is optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimeType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the MIME type of the message. This attribute is optional.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can define any of the following property types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inbound Properties</p>
</li>
<li>
<p>Invocation Properties</p>
</li>
<li>
<p>Outbound Properties</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use the same MEL functions, <code>getResource()</code>, <code>resultOfScript()</code> and <code>getBeanFromMuleContext()</code> to define the content of a Mule message property.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="defining-mock-response-exceptions"><a class="anchor" href="#defining-mock-response-exceptions"></a>Defining Mock Response Exceptions</h3>
<div class="paragraph">
<p>In some scenarios, you may want to validate how your flow behaves if a message processor throws an exception. For these cases MUnit offers the <code>throw-an</code> exception feature.</p>
</div>
<div class="paragraph">
<p>This feature is offered through a different message processor: <code>mock:throw-an</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:config name="mock_config" doc:name="Mock configuration"/&gt;
...
&lt;mock:throw-an whenCalling="mule:set-payload" exception-ref="#[new java.lang.Exception()]"&gt;
&lt;/mock:throw-an&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the structure of the <code>throw-an</code> message processor, you define which message processor you wish to mock, just like the <code>when</code> message processor. However, here you also need to define the exception that should be thrown by the mocked message processor.</p>
</div>
<div class="paragraph">
<p>Message Processor Attributes</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>whenCalling</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Describes which message processor we want to mock, in the form {name-space}:{message-processor-name}. Supports regular expressions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exception-ref</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the exception the mocked payload should throw.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="define_mock_response_exception"><a class="anchor" href="#define_mock_response_exception"></a>Defining a Mock Response Exception With Message Processor Attributes</h4>
<div class="paragraph">
<p>You can use <a href="#matchers">matchers</a>&#8201;&#8212;&#8201;parameters that match features of the desired message processor&#8201;&#8212;&#8201;to create a mock to throw an exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;mock:throw-an whenCalling="mule:set-payload" exception-ref="#[new java.lang.Exception()]"&gt;
  &lt;mock:with-attributes&gt;
    &lt;mock:with-attribute whereValue="#['Real Set Payload']" name="doc:name"/&gt;
  &lt;/mock:with-attributes&gt;
&lt;/mock:throw-an&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define as many attributes as you deem necessary to make the mock as
representative as possible. When defining an attribute, you do so by defining:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the attribute. This value is literal, it doesn&#8217;t support regular expressions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>whereValue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the value that the attribute of the real message processor should contain.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-mocks-with-java-code"><a class="anchor" href="#defining-mocks-with-java-code"></a>Defining Mocks with Java Code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The code below reproduces the example described <a href="#define_mock_response_exception">above</a>, but with the MUnit Java API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.junit.Test;
import org.mule.api.MuleMessage;
import org.mule.munit.common.mocking.Attribute;
import org.mule.munit.runner.functional.FunctionalMunitSuite;

public class TheTest extends FunctionalMunitSuite {

  @Test
  public void test() {
    Attribute attribute =
      Attribute.attribute("name").ofNamespace("doc").
        withValue("Real Set Payload"); <i class="conum" data-value="1"></i><b>(1)</b>

    MuleMessage messageToBeReturned =
      muleMessageWithPayload("Real Set Payload"); <i class="conum" data-value="2"></i><b>(2)</b>
    messageToBeReturned.setProperty("property_name",
      "property_value",PropertyScope.INBOUND); <i class="conum" data-value="3"></i><b>(3)</b>

    whenMessageProcessor("set-payload") <i class="conum" data-value="4"></i><b>(4)</b>
    .ofNamespace("mule")                <i class="conum" data-value="5"></i><b>(5)</b>
    .withAttributes(attribute)          <i class="conum" data-value="6"></i><b>(6)</b>
    .thenReturn(messageToBeReturned);   <i class="conum" data-value="7"></i><b>(7)</b>
  }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the real message processor attribute to match.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the Mule message that should be returned by the mocked message processor.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define the properties of the Mule message that should be returned by the mocked message processor.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the name of the message processor to be mocked (accepts regular expressions).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define the name of the namespace of the message processor to be mocked (accepts regular expressions).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Set the message processor&#8217;s attribute defined in (1).</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Set the message to be returned by the mocked message processor defined in (3).</td>
</tr>
</table>
</div>
</div>
</div>
  </article>
</main>
<footer class="footer"><div class="footer__wrapper">
      <div class="footer__top">
              </div>
      <div class="footer-bottom-wrapper">
        <!--<a href="/" title="Home" rel="home" class="header__logo" id="logo"><img src="/sites/all/themes/muletheme/images/mule_logo.svg" alt="Home" class="header__logo-image" /></a>-->
        <div class="connect-footer">
          <p>Sign up for our Dev newsletter</p>
          <div class="connect-footer">

</div>
  </div>
        <div class="terms-conditions temp">
          <div id="block-menu-menu-footer-bottom-menu" class="block block-menu contextual-links-region first last odd" role="navigation">
            <ul class="menu"><li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/" class="menu__link">MuleSoft.com</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/" class="menu__link">Blog</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/content/terms-service" class="menu__link">Terms</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/privacy-policy" class="menu__link">Privacy</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/contact" class="menu__link">Contact</a></li>
            </ul></div>
                    <div class="default-terms-conditions">
          </div>
          MuleSoft provides a widely used <a href="https://www.mulesoft.com/platform/enterprise-integration">integration platform</a> for connecting SaaS and enterprise applications in the cloud and on-premise. Delivered as a unified integration experience, <a href="https://www.mulesoft.com/platform/saas/cloudhub-ipaas-cloud-based-integration">CloudHub&trade;</a> and <a href="https://www.mulesoft.com/platform/soa/mule-esb-open-source-esb">Mule ESB&trade;</a> (Enterprise Service Bus) are built on proven open source technology for fast and reliable on-premise and cloud integration without vendor lock-in.


        </div>
      </div>
      <div class="footer-end">
        <div class="footer-logo-wrapper">
          <a href="https://developer.mulesoft.com/" class="footer-logo"></a>
        </div>
        <ul class="social-links"><li><a href="https://www.mulesoft.com/lp/contact" target="_blank" class="icon-muletheme-phone"></a></li>
          <li><a href="https://www.linkedin.com/company/mulesoft" target="_blank" class="icon-muletheme-linkedin"></a></li>
          <li><a href="https://twitter.com/muledev" target="_blank" class="icon-muletheme-twitter"></a></li>
          <li><a href="https://www.facebook.com/MuleSoft" target="_blank" class="icon-muletheme-facebook"></a></li>
          <li><a href="mailto:info@mulesoft.com" target="_blank" class="icon-muletheme-email"></a></li>
          <li><a href="https://videos.mulesoft.com/" target="_blank" class="icon-muletheme-youtube"></a></li>
        </ul><p class="copyright"><span>&copy;2017</span> MuleSoft, INC.</p>
      </div>
    </div>
    </footer><script src="../../_theme/scripts/menu.js"></script>
<script src="../../_theme/scripts/highlight.pack.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
