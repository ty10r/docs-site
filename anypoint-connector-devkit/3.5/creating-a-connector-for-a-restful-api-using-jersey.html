<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="keywords" content="">
  <link rel="canonical" href="https://ede65566-docs-migration.github.io/docs-site/anypoint-connector-devkit/3.5/creating-a-connector-for-a-restful-api-using-jersey.html">
  <link rel="stylesheet" href="../../_theme/stylesheets/theme.css">
  <title>Creating a Connector for a RESTful API Using Jersey // MuleSoft Documentation</title>
</head>
<body class="article">
<header class="header" id="header" role="banner"><div class="header__wrapper clearfix">
      <div class="header__logo--primary-nav clearfix">
        <a href="https://docs.mulesoft.com" title="Home" rel="home" class="header__logo" id="logo">
          <img src="../../_theme/images/mulesoft-dev-logo.svg" alt="Home" class="header__logo-image"></a>
          <div class="header__region region region-header">
    <div id="block-system-main-menu" class="block block-menu first last odd" role="navigation">

        <h2 class="block__title block-title">Main Dev Menu</h2>
    
  <ul class="menu"><li class="menu__item is-expanded first expanded"><span class="menu__link">Platform</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/dev/anypoint-studio" title="" class="menu__link">Studio</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/connectors" title="" class="menu__link">Connectors</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/anypoint-exchange" title="" class="menu__link">Exchange</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/design-api" title="" class="menu__link">API Designer</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-developer-portal" title="" class="menu__link">API Portal</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/mule-runtime-engine" title="" class="menu__link">Mule runtime engine</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/dev/api-management" title="" class="menu__link">API Manager</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/dev/reporting-api-analytics" title="" class="menu__link">API Analytics</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><span class="menu__link">Resources</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://developer.mulesoft.com/getting-started/anypoint-platform" class="menu__link">Getting started</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/tutorials-and-howtos" class="menu__link">Tutorials &amp; HowTos</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/webinars-and-videos" title="" class="menu__link">Webinars &amp; Videos</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/workshops" class="menu__link">Online Workshops</a></li>
<li class="menu__item is-leaf leaf"><a href="https://developer.mulesoft.com/integration-books-and-resources" class="menu__link">Books &amp; Whitepapers</a></li>
<li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/dev/" class="menu__link">Blog</a></li>
<li class="menu__item is-leaf leaf"><a href="https://docs.mulesoft.com" class="menu__link">Documentation</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://training.mulesoft.com" class="menu__link">Training</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><a href="https://developer.mulesoft.com/community" class="menu__link">Community</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="http://forum.mulesoft.org/" class="menu__link">Forums</a></li>
<li class="menu__item is-leaf leaf"><a href="https://meetups.mulesoft.com" class="menu__link">Meetups</a></li>
<li class="menu__item is-leaf leaf"><a href="http://s2.developer.mulesoft.com/" class="menu__link">Contributed Content</a></li>
<li class="menu__item is-leaf leaf"><a href="https://s2.developer.mulesoft.com/jobs.html" class="menu__link">Jobs</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.mulesoft.org/jira/browse/MULE" class="menu__link">Issue tracker</a></li>
</ul></li>
<li class="menu__item is-leaf last leaf"><a href="https://developer.mulesoft.com/champions" class="menu__link">Champions</a></li>
</ul></div>
  </div>
      </div> <!-- header__logo--primary-nav -->
      <div class="header__top-wrapper">
        <div class="header__nav-wrapper">
                      <div class="region region-header-top">
    <div id="block-search-form" class="block block-search first last odd" role="search">

      
  
</div>
  </div>
        </div>
        <div class="top-nav-ctas">
          <a class="icon-muletheme-phone" href="https://mulesoft.com/lp/contact" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-contact');"></a>
          <a href="https://anypoint.mulesoft.com/login/#/signup?apintent=dmc_generic" class="try" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-nav');">Try now</a>
          <a href="https://mulesoft.com/" class="dev" onclick="ga('send', 'event', 'CTA', 'Click', 'dmc-top-mscom');">MuleSoft.com</a>
        </div>
      </div> <!-- header__secondary-nav-search -->
    </div> <!-- header__wrapper -->
    <a href="#sidr" id="open-left" class="closed">
    </a>
  </header><main role="main" class="main-wrapper">
  <div class="navigation-wrapper">
    <nav role="navigation" class="navigation">
      <div class="search">
        <input type="text" placeholder="Search the docs" class="search-input" autocomplete="off" autocorrect="off" autocapitalize="off">
      </div>
      <div class="inner-nav">
          <ul class="nav-lst">
              <li class="nav-itm" data-depth="0" data-state="collapsed">
                  <button class="nav-tgl"></button>
                <a class="nav-lnk" href="index.html">Anypoint Connector DevKit</a>
                  <ul class="nav-lst">
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="index.html">Anypoint Connector DevKit</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                          <button class="nav-tgl"></button>
                        <a class="nav-lnk" href="setup.html">Setup</a>
                          <ul class="nav-lst">
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="setting-up-your-dev-environment.html">Setting Up Your Development Environment</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="setting-up-your-api-access.html">Setting up your API access</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-an-anypoint-connector-project.html">Creating an Anypoint Connector Project</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-an-anypoint-connector-project.html">Creating an Anypoint Connector Project</a>
                              </li>
                          </ul>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                          <button class="nav-tgl"></button>
                        <a class="nav-lnk" href="authentication.html">Authentication</a>
                          <ul class="nav-lst">
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="basic-auth.html">Basic Auth</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="oauth-v1.html">OAuth V1</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="oauth-v2.html">OAuth V2</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="authentication-methods.html">Authentication Method</a>
                              </li>
                          </ul>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                          <button class="nav-tgl"></button>
                        <a class="nav-lnk" href="defining-attributes-operations-and-data-model.html">Defining Attributes Operations and Data Model</a>
                          <ul class="nav-lst">
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="defining-message-sources.html">Defining Message Sources</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-message-processors.html">Creating Message Processors</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="defining-connector-attributes.html">Defining Connector Attributes</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="complex-data-types-attributes.html">Complex Data Types Attributes</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="adding-datasense.html">Adding DataSense</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="adding-datasense-query-language.html">Adding DataSense Query Language</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="adding-query-pagination-support.html">Adding Query Pagination Support</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="building-a-batch-enabled-connector.html">Building a Batch Enabled Connector</a>
                              </li>
                          </ul>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="installing-and-testing-your-connector-in-studio.html">Installing and Testing Your Connector</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="developing-devkit-connector-tests.html">Developing DevKit Connector Tests</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="creating-reference-documentation.html">Creating Reference Documentation</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="packaging-your-connector-for-release.html">Packaging Your Connector for Release</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="implementing-a-rest-connector.html">Implementing a REST Connector</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                        <a class="nav-lnk" href="annotation-reference.html">Annotation Reference</a>
                      </li>
                      <li class="nav-itm" data-depth="1" data-state="collapsed">
                          <button class="nav-tgl"></button>
                        <a class="nav-lnk" href="anypoint-connector-examples.html">Anypoint Connector Examples</a>
                          <ul class="nav-lst">
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="barn-connector.html">Barn Connector</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-a-connector-using-a-java-client-library.html">Creating a Connector Using a Java Client Library</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-a-connector-for-a-soap-service-via-cxf-client.html">Creating a Connector for a SOAP Service Via CXF Client</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-a-connector-for-a-restful-api-using-jersey.html">Creating a Connector for a RESTful API Using Jersey</a>
                              </li>
                              <li class="nav-itm" data-depth="2" data-state="collapsed">
                                <a class="nav-lnk" href="creating-a-connector-for-a-restful-api-using-restcall-annotations.html">Creating a Connector for a RESTful API using @RESTCall Annotations</a>
                              </li>
                          </ul>
                      </li>
                  </ul>
              </li>
          </ul>
      </div>
    </nav>
  </div>
  <article class="primary-content">
    <header class="article-header">
      <div class="breadcrumb">
        <strong class="breadcrumb-item">[ Domain Selector Placeholder ]</strong> /
        <span class="breadcrumb-item">Creating a Connector for a RESTful API Using Jersey</span>
      </div>
      <div class="edit-on-github">
        <a href="https://github.com/ede65566-docs-migration/anypoint-connector-devkit-docs/edit/v3.5/modules/ROOT/content/creating-a-connector-for-a-restful-api-using-jersey.adoc" class="edit-on-github-link">Edit on Github</a>
      </div>
    </header>
    <h1>Creating a Connector for a RESTful API Using Jersey</h1>
    <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This discussion presents the steps required to build a Jersey Client connector for a RESTful Web service. Jersey interacts with the service, and maps JSON to and from Java objects.</p>
</div>
<div class="paragraph">
<p>This example uses Dropbox&#8217;s RESTful service. In practice, building a Dropbox connector might be more simply achieved using an existing Java client library, but nonetheless this serves as a useful example.</p>
</div>
<div class="paragraph">
<p>This document leads you through building the connector, beginning with the service endpoint, documentation for the service, and its supported resources and operations. (A <a href="http://www.raml.org/">RAML</a> or <a href="https://developers.helloreverb.com/swagger/">Swagger</a> definition is an ideal source for this information, but any complete API documentation will give you what you need.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./_images/6-package.png" alt="6 package">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document assumes you are familiar with RESTful Web services, and have some understanding of Jersey. You can find useful background on Jersey in the <a href="https://jersey.java.net/documentation/1.6/user-guide.html">Jersey User Guide</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The straightforward path described here should produce a working connector for any RESTful API that uses JSON to represent requests and responses.</p>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jersey is the JAX-RS reference implementation, and is widely used for developing Java clients for RESTful Web services. Jersey also adds JAX-RS additional features and utilities, further simplifying RESTful service and client development.</p>
</li>
<li>
<p>This example uses the common 1.x branch of Jersey. Mule currently uses Jersey v1.6, so refer to the <a href="https://jersey.java.net/documentation/1.6/user-guide.html">Jersey 1.6 User Guide</a> for details where needed.</p>
</li>
<li>
<p>Internally, Jersey Client will use Jackson to perform this mapping. Some implementation details in this discussion are Jackson-specific.</p>
</li>
<li>
<p>This sample implements OAuth1 authentication. Find a more detailed discussion of implementing OAuth1 support (with reference to the same sample code) in <a href="oauth-v1.html">Implementing OAuth 1.0 Authentication</a>. Implementing OAuth2 support is similar; see <a href="oauth-v2.html">Implementing OAuth 2.0 Authentication</a> for more details.</p>
</li>
<li>
<p>MuleSoft recommends and documents the Jersey Client-based approach, based on success with Jersey in MuleSoft-developed connectors; however you can also use other frameworks, such as Apache CXF, to create RESTful clients.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connector-architecture-with-jersey-client"><a class="anchor" href="#connector-architecture-with-jersey-client"></a>Connector Architecture with Jersey Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On a new connector project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a <code>@Connector</code> class and add authentication logic.</p>
</li>
<li>
<p>Create Java classes (unless you are using Maps) that represent any entities passed to or returned from the service operations</p>
</li>
<li>
<p>Build a Jersey-based client in Java that works against the web service API, and converts POJOs or Maps to and from JSON for use in Mule</p>
</li>
<li>
<p>Wrap the Jersey-based client class with the <code>@Connector</code> class that integrates it with Mule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The final architecture looks like the image below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./_images/devkit-connector-jersey.png" alt="devkit connector jersey">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dropbox-restful-example-connector"><a class="anchor" href="#dropbox-restful-example-connector"></a>Dropbox RESTful Example Connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sample connector used in this discussion connects to <a href="https://www.dropbox.com/developers/core/docs">DropBox&#8217;s Core API</a>. Find the connector source code on <a href="https://github.com/mulesoft/devkit-documentation-rest-jersey">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>The connector exposes the API operation <code>GET <a href="https://api.dropbox.com/1/account/info" class="bare">https://api.dropbox.com/1/account/info</a></code> which retrieves information about the Dropbox Account resource, described in the <a href="https://www.dropbox.com/developers/core/docs#account-info">Dropbox documentation</a>.</p>
</div>
<div class="paragraph">
<p>A typical response to this method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">{
    "referral_link": "https://www.dropbox.com/referrals/r1a2n3d4m5s6t7",
    "display_name": "John P. User",
    "uid": 12345678,
    "country": "US",
    "quota_info": {
        "shared": 253738410565,
        "quota": 107374182400000,
        "normal": 680031877871
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the account information is a JSON object with several fields, which in turn contains a nested JSON object for account quota information. The connector will have to translate both of these JSON objects to POJOs for the response to be consumable in Mule.</p>
</div>
<div class="paragraph">
<p>The connector also exposes a second operation at the Mule level. <code>LogInfo</code> logs the OAuth access token and access token secret (but does not at any time call the Dropbox Web service). You may want to include similar debugging utility operations in a connector during development.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="development-process-outline"><a class="anchor" href="#development-process-outline"></a>Development Process Outline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several major tasks in developing a connector with Jersey Client; these are outlined below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Assuming you&#8217;ve prepared an initial connector project:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add Jersey and Jackson dependencies to POM.</p>
</li>
<li>
<p>Create any client or entities packages.</p>
</li>
<li>
<p>Rebuild project with the new dependencies.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the Jersey Client class.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enable Jersey Client JSON-POJO mapping.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the Connector class.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add OAuth.</p>
</li>
<li>
<p>Build and test connector.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Add an operation.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add operation to client class, and add required POJOs to project.</p>
</li>
<li>
<p>Expose client operation via Connector class.</p>
</li>
<li>
<p>Build and test manually (Optional).</p>
</li>
<li>
<p>Define and run unit tests and Javadoc examples.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="prepared-connector-project"><a class="anchor" href="#prepared-connector-project"></a>Prepared Connector Project</h3>
<div class="paragraph">
<p>Once you have created a connector project as described in <a href="creating-an-anypoint-connector-project.html">Creating an Anypoint Connector Project</a>, you must add Jersey, Jackson, and JSON-related dependencies to the POM, and create packages and classes you will use in your connector before adding operations.</p>
</div>
<div class="sect3">
<h4 id="adding-dependencies-to-the-pom"><a class="anchor" href="#adding-dependencies-to-the-pom"></a>Adding Dependencies to the POM</h4>
<div class="paragraph">
<p>The following <code>&lt;dependency&gt;</code> elements add Jersey, Jackson, and Mule JSON support to your project:</p>
</div>
<div class="paragraph">
<p><strong>POM Dependencies for Jersey, Jackson and JSON</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Add this to use Jersey Client --&gt;
    &lt;dependency&gt;
            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
            &lt;version&gt;${jersey.client.version}&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;!-- Add this to use Mule support for JSON based on Jackson --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mule.modules&lt;/groupId&gt;
            &lt;artifactId&gt;mule-module-json&lt;/artifactId&gt;
            &lt;version&gt;${mule.version}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add these to the <code>&lt;dependencies&gt;</code> element in your POM, along with any other dependencies required by your project. For example, the Dropbox sample connector adds the following additional dependency for OAuth support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- Add this to use OAuth support in DevKit--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;oauth.signpost&lt;/groupId&gt;
            &lt;artifactId&gt;signpost-core&lt;/artifactId&gt;
            &lt;version&gt;1.2.1.2&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The complete POM for the Dropbox sample connector project as generated from the DevKit 3.5 connector Maven archetype is shown below.</p>
</div>
<div class="listingblock">
<div class="title">Dropbox RESTful Connector pom.xml:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;org.mule.samples.devkit&lt;/groupId&gt;
    &lt;artifactId&gt;dropboxrest&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;mule-module&lt;/packaging&gt;
    &lt;name&gt;Mule ${serviceName} Cloud Connector&lt;/name&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.mule.tools.devkit&lt;/groupId&gt;
        &lt;artifactId&gt;mule-devkit-parent&lt;/artifactId&gt;
        &lt;version&gt;3.5.0-andes&lt;/version&gt;
    &lt;/parent&gt;
    &lt;properties&gt;
        &lt;junit.version&gt;4.9&lt;/junit.version&gt;
        &lt;mockito.version&gt;1.8.2&lt;/mockito.version&gt;
        &lt;jdk.version&gt;1.6&lt;/jdk.version&gt;
        &lt;category&gt;Cloud Connectors&lt;/category&gt;
        &lt;licensePath&gt;LICENSE.md&lt;/licensePath&gt;
        &lt;devkit.studio.package.skip&gt;false&lt;/devkit.studio.package.skip&gt;
        &lt;serviceName&gt;DropBox REST Sample&lt;/serviceName&gt;

        &lt;!-- required for Jersey Client --&gt;
        &lt;jersey.client.version&gt;1.6&lt;/jersey.client.version&gt;
        &lt;jersey.multipart.version&gt;1.3&lt;/jersey.multipart.version&gt;
    &lt;/properties&gt;

 &lt;dependencies&gt;
        &lt;!-- Add this to use OAuth support in DevKit--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;oauth.signpost&lt;/groupId&gt;
            &lt;artifactId&gt;signpost-core&lt;/artifactId&gt;
            &lt;version&gt;1.2.1.2&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- Add this to use Jersey Client --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
            &lt;version&gt;${jersey.client.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- Add this to use Mule support for JSON --&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.mule.modules&lt;/groupId&gt;
            &lt;artifactId&gt;mule-module-json&lt;/artifactId&gt;
            &lt;version&gt;${mule.version}&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

 &lt;/dependencies&gt;
&lt;/project&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="creating-packages-for-supporting-classes"><a class="anchor" href="#creating-packages-for-supporting-classes"></a>Creating Packages for Supporting Classes</h4>
<div class="paragraph">
<p>The Dropbox REST Connector uses the following organization to support the different classes used in its connector:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package <code>org.mule.examples.restjerseyconnector.client</code> contains the Jersey Client code class <code>DropboxClient.java</code></p>
</li>
<li>
<p>package <code>org.mule.examples.restjerseyconnector.exception</code> defines exceptions that can be thrown by the connector: <br></p>
<div class="ulist">
<ul>
<li>
<p><code>DropboxRestConnectorTokenExpiredException</code>:` `a security/authentication exception</p>
</li>
<li>
<p><code>DropboxRestConnectorException</code>:` `a catchall exception</p>
</li>
</ul>
</div>
</li>
<li>
<p>Package <code>org.mule.examples.restjerseyconnector.entities</code> contains two POJOs: <code>AccountInfo</code> and <code>QuotaInfo</code>, which represent the results from the Dropbox API</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The entity classes  typically wind up as incoming or outgoing payloads for operations on your connector. One way to know whether your connector  needs entity classes is to look at any documentation or metadata that you have about requests and responses. Wherever you see any JSON Arrays or complex Objects, you  need corresponding entity classes.</p>
</div>
<div class="paragraph">
<p>For now, create the package but don&#8217;t populate it with classes.</p>
</div>
<div class="paragraph">
<p>If your connector presents only Maps to Mule, then you probably won&#8217;t need to create this package. Only use Maps if your connector is presenting a dynamic data model.</p>
</div>
</div>
<div class="sect3">
<h4 id="rebuilding-the-project-with-new-dependencies"><a class="anchor" href="#rebuilding-the-project-with-new-dependencies"></a>Rebuilding the Project with New Dependencies</h4>
<div class="paragraph">
<p>Now that your POM file includes these additions, perform a clean build and install of your project. Doing so now is a convenient way to spot any errors in your POM before you start doing any real coding.</p>
</div>
<div class="paragraph">
<p>Run the following Maven command on the command line from the directory where the project exists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn clean install</pre>
</div>
</div>
<div class="paragraph">
<p>This command invokes Maven with two goals:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Clean</code> tells Maven to wipe out all previous build contents.</p>
</li>
<li>
<p><code>Install</code> tells Maven to:<br></p>
<div class="ulist">
<ul>
<li>
<p>Compile all the code for the project</p>
</li>
<li>
<p>Run any defined tests</p>
</li>
<li>
<p>Package the compiled code as an Eclipse update site</p>
</li>
<li>
<p>Install it in the local Maven repository</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Any failure during this process, such as a failed build or test, stops Maven from attempting subsequent goals. For further details on Maven builds, see <a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Introduction to the Build Lifecycle</a> at the Apache Maven project.</p>
</div>
<div class="paragraph">
<p>Your preferred IDE should have support for this process as well. For example, in Eclipse if you have m2eclipse installed, you can select the project and invoke <strong>Run as &gt; Maven Build.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-client-class-and-code-connector-code-class"><a class="anchor" href="#create-client-class-and-code-connector-code-class"></a>Create Client Class and <code>@Connector</code> Class</h3>
<div class="paragraph">
<p>The client class does the real work of preparing and making calls to the remote Web service. It serializes and deserializes the request and response entities as JSON. The <code>@Connector</code> class creates an instance of the client class when needed, and calls methods to perform operations on resources. The two related tasks here are to create the client class, and update the <code>@Connector</code> class to instantiate and reference it.</p>
</div>
<div class="paragraph">
<p>The client class builds on functionality provided by the Jersey Client. See the <a href="https://jersey.java.net/documentation/1.6/user-guide.html#client-api">Jersey 1.6 User Guide</a> for more information.</p>
</div>
<div class="sect3">
<h4 id="required-imports-for-the-client-class"><a class="anchor" href="#required-imports-for-the-client-class"></a>Required Imports for the Client Class</h4>
<div class="paragraph">
<p>In order to pick up Jackson and Jersey client functionality, the client class will require at least the following imports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">import javax.ws.rs.core.MediaType;
import com.sun.jersey.api.client.*;
import com.sun.jersey.api.client.config.ClientConfig;
import com.sun.jersey.api.client.config.DefaultClientConfig;
import com.sun.jersey.api.json.JSONConfiguration;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional imports may be needed for Jersey and Jackson, depending on their use in your particular client. For example, the sample client uses the following imports for OAuth functionality in Jersey:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">import com.sun.jersey.oauth.client.OAuthClientFilter;
import com.sun.jersey.oauth.signature.OAuthParameters;
import com.sun.jersey.oauth.signature.OAuthSecrets;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client class in the sample client does not make direct calls to Jackson, so no imports are required.</p>
</div>
<div class="paragraph">
<p>Expect to add more imports as you add operations, for example if you need to pick up any entity classes and exceptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="client-class-properties-and-constructor"><a class="anchor" href="#client-class-properties-and-constructor"></a>Client Class Properties and Constructor</h4>
<div class="paragraph">
<p>The easiest way to understand how to build your client class constructor is to look at the constructor for the sample connector&#8217;s client class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class DropboxClient {
    private Client client; /* a Jersey client instance */
    private WebResource apiResource;
    private RestJerseyConnector connector;

    public DropboxClient(RestJerseyConnector connector) {
        setConnector(connector);
        ClientConfig clientConfig = new DefaultClientConfig();
/* enable support for JSON to POJO entity mapping in Jersey */
        clientConfig.getFeatures().put(JSONConfiguration.FEATURE_POJO_MAPPING, Boolean.TRUE);
        this.client = Client.create(clientConfig);
        this.apiResource = this.client.resource(getConnector().getApiUrl() + "/" + getConnector().getApiVersion());
    }

...

/* getters, setters and other methods omitted*/

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certain <code>@Connector</code> class values are used frequently in the client class code:<br></p>
<div class="ulist">
<ul>
<li>
<p>API URL and version</p>
</li>
<li>
<p>Operations for OAuth<br></p>
<div class="ulist">
<ul>
<li>
<p>Consumer key</p>
</li>
<li>
<p>Access token</p>
</li>
<li>
<p>Consumer secret</p>
</li>
<li>
<p>Access token secret</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Without passing <code>@Connector</code> class values to every operation or defining them in two places:<br></p>
<div class="ulist">
<ul>
<li>
<p>Such values are defined as properties on the <code>@Connector</code> class</p>
</li>
<li>
<p>An instance of the <code>@Connector</code> class is passed into the client class constructor and stored as a property on the client class</p>
</li>
</ul>
</div>
</li>
<li>
<p>Every client operation will use instances of <code>com.sun.jersey.api.Client</code> (the actual Jersey client instance) and <code>com.sun.jersey.api.client.WebResource</code> (which represents the top level resource on the service). So these instances are created in the constructor and stored on the client class&#8217;s <code>client.</code> and <code>apiResource</code> properties. (Getters and setters for these instances are defined, but that code is omitted here.)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="enabling-jersey-client-json-to-pojo-mapping"><a class="anchor" href="#enabling-jersey-client-json-to-pojo-mapping"></a>Enabling Jersey Client JSON-to-POJO Mapping</h4>
<div class="paragraph">
<p>To configure a Jersey client instance to enable optional functionality, such as support to map JSON content to POJOs, complete these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an instance of <code>ClientConfig</code>.</p>
</li>
<li>
<p>Set the desired options.</p>
</li>
<li>
<p>Pass the <code>ClientConfig</code> to the <code>Client.create()</code> method.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In this case, adding the feature <code>JSONConfiguration.FEATURE_POJO_MAPPING</code>  enables the mapping of JSON responses to Java objects.</p>
</div>
<div class="paragraph">
<p>You will need this functionality regardless of whether you are using a static data model with POJOs for your entities, or a dynamic data model with Maps for your entities.</p>
</div>
<div class="paragraph">
<p>Later, define the entities passed to and from the class with annotations on the entity classes to control how JSON documents are mapped to object instances.</p>
</div>
<div class="paragraph">
<p>Note that while Jackson is the default provider of serialization/deserialization for Jersey, you can substitute other providers, such as GSON. Also,<strong> </strong>note that using a different provider will change how you map the service&#8217;s JSON documents to your connector&#8217;s entity classes; for more information, refer to your serialization provider&#8217;s documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="client-class-code-before-adding-operations-and-authentication"><a class="anchor" href="#client-class-code-before-adding-operations-and-authentication"></a>Client Class Code, Before Adding Operations and Authentication</h3>
<div class="paragraph">
<p>The complete code for our sample connector, before adding operations and references to entities used, is shown below.</p>
</div>
<div class="listingblock">
<div class="title">DropboxRESTClient.java Before Adding Operations:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">package org.mule.examples.restjerseyconnector.client;

import javax.ws.rs.core.MediaType;

import com.sun.jersey.api.client.*;
import com.sun.jersey.api.client.config.ClientConfig;
import com.sun.jersey.api.client.config.DefaultClientConfig;
import com.sun.jersey.api.json.JSONConfiguration;
import com.sun.jersey.oauth.client.OAuthClientFilter;
import com.sun.jersey.oauth.signature.OAuthParameters;
import com.sun.jersey.oauth.signature.OAuthSecrets;
import org.mule.examples.restjerseyconnector.RestJerseyConnector;
import org.mule.examples.restjerseyconnector.entities.AccountInfo;
import org.mule.examples.restjerseyconnector.exception.RestJerseyConnectorException;
import org.mule.examples.restjerseyconnector.exception.RestJerseyConnectorTokenExpiredException;

public class DropboxClient {

    private Client client;
    private WebResource apiResource;
    private RestJerseyConnector connector;

    public DropboxClient(RestJerseyConnector connector) {
        setConnector(connector);

        ClientConfig clientConfig = new DefaultClientConfig();
        clientConfig.getFeatures().put(JSONConfiguration.FEATURE_POJO_MAPPING, Boolean.TRUE);
        this.client = Client.create(clientConfig);
        this.apiResource = this.client.resource(getConnector().getApiUrl() + "/" + getConnector().getApiVersion());
    }

    public Client getClient() {
        return client;
    }

    public void setClient(Client client) {
        this.client = client;
    }

    public WebResource getApiResource() {
        return addSignHeader(apiResource);
    }

    public void setApiResource(WebResource apiResource) {
        this.apiResource = apiResource;
    }

    public RestJerseyConnector getConnector() {
        return connector;
    }

    public void setConnector(RestJerseyConnector connector) {
        this.connector = connector;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="completing-the-connector-class"><a class="anchor" href="#completing-the-connector-class"></a>Completing the @Connector Class</h3>
<div class="paragraph">
<p>When you created your connector project, Maven generated a skeleton <code>@Connector</code> class for you. Now you will enhance it to add needed properties (some of them <code>@Configurable</code>), initialize the client class when the <code>@Connector</code> is initialized, and add authentication functionality.</p>
</div>
<div class="paragraph">
<p>Your connector uses <code>@Configurable</code> properties for a few purposes, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changing the API root resource URL and version for the service to target a specific sandbox or test system instead of a production environment</p>
</li>
<li>
<p>Storing authentication-related values the user must configure:<br></p>
<div class="ulist">
<ul>
<li>
<p>For OAuth: the API key and API secret</p>
</li>
<li>
<p>For basic authentication: a username and password.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There may also be properties that are not <code>@Configurable</code> but that are used internally. For the example, OAuth1 support needs certain properties for the access token and access token secret.</p>
</div>
<div class="paragraph">
<p>Create properties as needed for all of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">/**
     * Dropbox API Url
     */
    @Configurable @Optional @Default("https://api.dropbox.com")
    private String apiUrl;

    /**
     * Dropbox API version
     */
    @Configurable @Optional @Default("1")
    private String apiVersion;

    /**
     * The ApiKey
     */
    @Configurable @OAuthConsumerKey
    private String consumerKey;
    /**
     * The consumerSecret
     */
    @Configurable @OAuthConsumerSecret
    private String consumerSecret;


    @OAuthAccessToken
    private String accessToken;

    @OAuthAccessTokenSecret
    private String accessTokenSecret;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The use of <code>@Optional</code> and <code>@Default</code> with <code>@Configurable</code>. For more on these annotations, see <a href="defining-connector-attributes.html">Defining Connector Attributes</a></p>
</li>
<li>
<p>The use of the OAuth annotations</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-connector-class-start-method-and-the-client-class"><a class="anchor" href="#the-connector-class-start-method-and-the-client-class"></a>The @Connector Class @Start Method and the Client Class</h3>
<div class="paragraph">
<p>The <code>@Connector</code> class in this instance does NOT have a constructor. Most of its instance properties are configuration properties. Instead, a <code>@Start</code> method leverages the Mule life cycle to create an instance of the client class when first needed. It is then saved in an instance variable on the @<code>Connector</code> class:</p>
</div>
<div class="paragraph">
<p>See Integrating Connectors with the Mule Life Cycle for details on the use of the <code>@Start</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example illustrates a useful pattern you can follow in your own connectors.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The client class constructor takes a reference to the <code>@Connector</code> class instance. The properties of the <code>@Connector</code> class (including configurable properties) are readily available in the client by calling the getters and setters. This is far easier than passing <code>@Connector</code> properties to individual operations as single arguments.</p>
</li>
<li>
<p>The <code>@Connector</code> class instance saves a reference to the client class instance, which can be used to call methods on the client class. This instance can also be used in a <code>@Stop</code> method, thus tying the lifecycle of the client class instance to the <code>@Connector</code> class instance.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="adding-oauth-authentication"><a class="anchor" href="#adding-oauth-authentication"></a>Adding OAuth Authentication</h3>
<div class="paragraph">
<p>Supporting OAuth 1.0a authentication requires that you make changes in both the <code>@Connector</code> class and the client class. These changes are outlined below.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import OAuth packages.</p>
</li>
<li>
<p>Add OAuth annotations to the <code>@Connector</code> class as required for authentication.</p>
</li>
<li>
<p>Add OAuth-related <code>@Configurable</code> properties:<br></p>
<div class="ulist">
<ul>
<li>
<p>API key</p>
</li>
<li>
<p>API secret</p>
</li>
<li>
<p>access token</p>
</li>
<li>
<p>access token secret (including setters and getters)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Include the client class code to pass OAuth 1.0a request headers with each request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For a detailed discussion on the code changes required for OAuth support, see<a href="oauth-v1.html">Implementing OAuth 1.0 Authentication</a>, which references the same code sample used in this discussion.</p>
</div>
</div>
<div class="sect2">
<h3 id="building-and-testing-your-connector"><a class="anchor" href="#building-and-testing-your-connector"></a>Building and Testing your Connector</h3>
<div class="paragraph">
<p>At this point, your connector project has all the necessary elements to build and install in Studio. It&#8217;s a handy sanity check to perform testing before you begin adding operations.</p>
</div>
<div class="paragraph">
<p>The process is described in <a href="installing-and-testing-your-connector-in-studio.html">Installing and Testing Your Connector</a>.</p>
</div>
<div class="paragraph">
<p>Building the bare-bones version of the Jersey client connector and installing it in Studio gives you a component in the palette to drag and drop into the canvas.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding-an-operation-to-the-connector"><a class="anchor" href="#adding-an-operation-to-the-connector"></a>Adding an Operation to the Connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To add an operation to a connector, you must</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define any entity classes used with the operation, and any new exceptions to be raised</p>
</li>
<li>
<p>In the client class, add Jersey code to call the operation, and to serialize and deserialize results</p>
</li>
<li>
<p>Add a <code>@Processor</code> method to the <code>@Connector</code> class to expose the operation to Mule</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Apply a Test-Driven Approach</strong><br></p>
</div>
<div class="paragraph">
<p>When it comes to adding operations to your connector, many successful projects follow a cycle similar to test-driven development.</p>
</div>
<div class="paragraph">
<p>First, identify detailed requirements for the operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Entities (POJOs or Maps with specific content) it can accept as input or return as responses</p>
</li>
<li>
<p>Responses expected for a range of valid and invalid inputs</p>
</li>
<li>
<p>Any exceptions the operation may raise, in the event of service unavailability, authentication failure, invalid inputs, and so on</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, iterate through the following cycle until you have completed all of your planned functionality:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create JUnit tests that cover the expected behaviors.</p>
</li>
<li>
<p>Implement functionality to satisfy those requirements:<br></p>
</li>
<li>
<p>Define entities (and annotate them as needed for mapping to/from JSON).</p>
</li>
<li>
<p>Create or enhance a method in the client class and a <code>@Processor</code> method in the <code>@Connector</code> class.</p>
</li>
<li>
<p>Update your <code>@Connector</code> class with required code snippet comments.</p>
</li>
<li>
<p>Run a Maven build to run the JUnit tests and fix any errors until all tests pass.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Continue until you cover all the functionality for each operation. When complete, you have a complete validation suite for your connector to catch any regressions in the event of changes in the target service, the connector itself, Mule, or DevKit.</p>
</div>
<div class="paragraph">
<p>You may ask, "When do I try my connector in Studio?" It is useful, as well as gratifying, to manually test each operation as you go, in addition to the automated JUnit tests. Testing each operation allows you to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See basic operation functionality in action as you work on it, which gives you a sense of progress</p>
</li>
<li>
<p>See how the connector appears in Studio, something the automated unit tests cannot show you. For example, text from the Javadoc comments is used to populate tooltips for the fields in the dialog boxes in the connector</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Manual testing provides the opportunity to polish the appearance of the connector, improve the experience with sensible defaults, and so on.</p>
</div>
<div class="paragraph">
<p>However, this does not diminish the value of the test-driven approach. Many connector development projects have bogged down or produced hard-to-use connectors because of a failure to define tests as you define the operations, which it seems like (and is) more work up front, but does pay off  you get a better result, faster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="defining-and-annotating-entity-classes"><a class="anchor" href="#defining-and-annotating-entity-classes"></a>Defining and Annotating Entity Classes</h3>
<div class="paragraph">
<p>Defining entity classes (POJOs or Maps) used with your connector operations is up to you  you decide the object model your connector operations present to the rest of Mule. Once you define these classes, you also have to define how to map between the JSON structure and your POJOs. You should add these incrementally, as they are needed by the operations you build.</p>
</div>
<div class="paragraph">
<p>Internally, Jersey relies on a Jackson-based serialization provider to marshal and unmarshal JSON documents to the object classes passed to and from your connector. This process relies upon Jackson annotations that describe how to map the fields of your entity POJOs to the structure of the JSON content being returned by the Web service.</p>
</div>
<div class="paragraph">
<p>The details on the Jackson annotations used for this purpose are in the <a href="https://github.com/FasterXML/jackson-databind">Jackson Databind annotations documentation</a> and the <a href="https://github.com/FasterXML/jackson-annotations">full Jackson annotations documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the <code>@Generated</code> annotation on class <code>AccountInfo</code> indicates that this class definition was produced using the  <code>jsonschema2pojo</code> utility. If you don&#8217;t want to come up with your own data model, you can also make use of <code>jsonschema2pojo</code> to generate class definitions from sample JSON documents.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Online Tool</strong><br></p>
</div>
<div class="paragraph">
<p>Covering all possible permutations of mapping a JSON schema or document to a POJO using Jackson is beyond the scope of this document. One way to quickly produce an object model from JSON documents returned by a Web service is to use the <a href="https://github.com/joelittlejohn/jsonschema2pojo">jsonschema2pojo project</a> and <a href="http://www.jsonschema2pojo.org/">online utility</a>. This utility was used to produce the entity classes in this example. You can see the final results in the <a href="https://github.com/mulesoft/devkit-documentation-rest-jersey/tree/master/src/main/java/org/mule/examples/restjerseyconnector/entities">project entity class code in GitHub</a> and particularly for the above code snippet, the <a href="https://github.com/mulesoft/devkit-documentation-rest-jersey/tree/master/src/main/java/org/mule/examples/restjerseyconnector/entities">AccountInfo class</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mapping the class and its members to a JSON document requires that you make a few changes, outlined below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>annotate the entity class to configure JSON serialization:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JsonSerialize(include = JsonSerialize.Inclusion.NON_NULL)
@Generated("com.googlecode.jsonschema2pojo")
@JsonPropertyOrder({ "referral_link", "display_name", "uid", "country", "quota_info" })
public class AccountInfo {
 ...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>@JsonProperty</code> annotation to the entity class instance properties (and their getters and setters):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@JsonProperty("referral_link")
    private String referralLink;

...

    @JsonProperty("referral_link")
    public String getReferralLink() {
        return referralLink;
    }


    @JsonProperty("referral_link")
    public void setReferralLink(String referralLink) {
        this.referralLink = referralLink;
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="implement-the-operation-in-the-client-class"><a class="anchor" href="#implement-the-operation-in-the-client-class"></a>Implement the Operation in the Client Class</h3>
<div class="paragraph">
<p>Next, you add code to the client class to make the Web Service request via Jersey Client.</p>
</div>
<div class="sect3">
<h4 id="helper-adding-authentication-to-jersey-client-requests"><a class="anchor" href="#helper-adding-authentication-to-jersey-client-requests"></a>Helper: Adding Authentication to Jersey Client Requests</h4>
<div class="paragraph">
<p>Depending on what method of authentication you are using, you will probably have to make code changes in both the <code>@Connector</code> and client classes to implement each operation called on the target service.</p>
</div>
<div class="paragraph">
<p>In the sample connector, the DropBox API uses OAuth 1.0 to access protected resources. Authentication requires including an authorization header when sending each request.</p>
</div>
<div class="paragraph">
<p>Jersey provides a filter chaining mechanism for modifying requests, which can be used to add the header. Because this step is needed for any operation protected by OAuth, the sample uses the convenient method <code>addSignHeader</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">/**
     * Adds the required OAuthClientFilter to insert the required header when the WebResource is used
     * to access the protected resources of the DropBox API
     *
     * @param webResource The WebResource in which the header will be added
     */
    private WebResource addSignHeader(WebResource webResource) {
        OAuthParameters params = new OAuthParameters();
        params.signatureMethod("PLAINTEXT");
        params.consumerKey(getConnector().getConsumerKey());
        params.setToken(getConnector().getAccessToken());
        OAuthSecrets secrets = new OAuthSecrets();
        secrets.consumerSecret(getConnector().getConsumerSecret());
        secrets.setTokenSecret(getConnector().getAccessTokenSecret());
        OAuthClientFilter filter = new OAuthClientFilter(client.getProviders(), params, secrets);
        webResource.addFilter(filter);
        return webResource;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see the <a href="https://jersey.java.net/nonav/apidocs/1.12/jersey/contribs/jersey-oauth/oauth-client/com/sun/jersey/oauth/client/OAuthClientFilter.html">OAuthClientFilter documentation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="helper-executing-a-request-via-jersey"><a class="anchor" href="#helper-executing-a-request-via-jersey"></a>Helper: Executing a Request via Jersey</h4>
<div class="paragraph">
<p>Making any request requires:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marshaling inbound objects to JSON</p>
</li>
<li>
<p>Calling the Web service</p>
</li>
<li>
<p>Unmarshaling the response</p>
</li>
<li>
<p>Handling response status codes and exceptions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with authentication, use a helper method to encapsulate all these repeated steps. In the sample client class, method <code>execute()</code> implements all this logic, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">/**
     * Executes the Dropbox request
     *
     */
    private &lt;T&gt; T execute(WebResource webResource, String method, Class&lt;T&gt; returnClass) throws RestJerseyConnectorTokenExpiredException,
            RestJerseyConnectorException {
        ClientResponse clientResponse = webResource.accept(MediaType.APPLICATION_JSON).method(method, ClientResponse.class);
        if(clientResponse.getStatus() == 200) {
            return clientResponse.getEntity(returnClass);
        } else if (clientResponse.getStatus() == 401) {
            throw new RestJerseyConnectorTokenExpiredException("The access token has expired; " +
                    clientResponse.getEntity(String.class));
        } else {
            throw new RestJerseyConnectorException(
                    String.format("ERROR - statusCode: %d - message: %s",
                            clientResponse.getStatus(), clientResponse.getEntity(String.class)));
        }
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="handling-exceptions"><a class="anchor" href="#handling-exceptions"></a>Handling Exceptions</h4>
<div class="paragraph">
<p>As already noted, define any exceptions that may arise in your connector in a separate exceptions package. At a minimum, you need a general catch-all exception. Specific exceptions may also be useful to diagnose failures more easily, such as authentication-related failures, application-level errors, and so on. The <code>execute()</code> method above is a good place to centralize your exception-handling code, since it passes all requests for all operations.</p>
</div>
<div class="paragraph">
<p>For our sample connector, package <code>org.mule.examples.restjerseyconnector.exception</code> contains two exceptions: a catchall <code>RestJerseyConnectorException</code> and the OAuth-related <code>RestJerseyConnectorTokenExpiredException</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note also that the <code>execute()</code> method provides a well-formatted error message. This step improves your ability to diagnose the issue if your connector encounters an error. You may want to put more verbose information here, such as the message sent, the HTTP request method, and so on.<br>
<br>
As you develop your test cases, your tests of invalid or failed requests can check for messages associated with the correct exception.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <code>@InvalidateConnectionOn</code> annotation to handle the reconnection. If the connector uses <code>@OAuth</code> as the authentication method, use <code>@OAuthInvalidateAccessTokenOn</code> (exception = <code>MyAccessTokenExpiredException.class</code>).</p>
</div>
</div>
<div class="sect3">
<h4 id="creating-the-operation-client-method"><a class="anchor" href="#creating-the-operation-client-method"></a>Creating the Operation Client Method</h4>
<div class="paragraph">
<p>With those helper classes in place, the actual client method to make a request of a resource is quite short. For the example, the <code>getAccountInfo()</code> method makes a GET request of the <code>/account/info</code> resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">/**
     * Returns the Account Information of the user
     *
     * @return The AccountInfo
     * @throws org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorException If the response is an error or the response cannot be parsed as an AccountInfo
     * @throws org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorTokenExpiredException If the current token used for the call to the service is no longer valid
     */
    public AccountInfo getAccountInfo()
            throws RestJerseyConnectorException, RestJerseyConnectorTokenExpiredException {
        WebResource webResource = getApiResource().path("account").path("info");
        return execute(webResource, "GET", AccountInfo.class);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposing-the-operation-in-the-connector-class"><a class="anchor" href="#exposing-the-operation-in-the-connector-class"></a>Exposing the Operation in the @Connector Class</h3>
<div class="paragraph">
<p>To expose an operation from the client class on the <code>@Connector</code> class, you will need to add a <code>@Processor</code> method that calls the corresponding method on the Jersey client.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update the <code>@Connector</code> class to import any entity and exception classes needed to call the client class operation.</p>
</li>
<li>
<p>Define a <code>@Processor</code> method on the <code>@Connector</code> class, named for the operation. <br></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Annotate the method as needed for authentication.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The parameters to this method must match the parameters to expose at the Mule ESB level (in the XML configuration or in the property dialog). <br></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Annotate the parameters to control default and optional values, their desired positions in Studio property dialogs, etc.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The method body should call the operation method on the client class, pass the appropriate object, and return the value to be set to the payload.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For our <code>getAccountInfo</code> operation, we add the following imports in the <code>@Connector</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.mule.examples.restjerseyconnector.entities.AccountInfo;
import org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorException;
import org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorTokenExpiredException;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Processor</code> method that exposes the` getAccountInfo` operation is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">/**
     * Returns the Account Information of the user
     *
     * {@sample.xml ../../../doc/rest-jersey-connector.xml.sample rest-jersey:get-account-info}
     *
     * @return The AccountInfo object
     * @throws org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorException If the response is an error or the response cannot be parsed as an AccountInfo
     * @throws org.mule.examples.restjerseyconnector.exceptions.RestJerseyConnectorTokenExpiredException If the current token used for the call to the service is no longer valid
     */
    @OAuthProtected
    @Processor
    public AccountInfo getAccountInfo() throws RestJerseyConnectorException, RestJerseyConnectorTokenExpiredException {
        return getClient().getAccountInfo();
    }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-xml-configuration-examples-for-javadoc"><a class="anchor" href="#adding-xml-configuration-examples-for-javadoc"></a>Adding XML Configuration Examples for JavaDoc</h3>
<div class="paragraph">
<p>DevKit enforces Javadoc documentation of the connector&#8217;s operations, including samples of XML configuration for each supported operation. These are used in the generated JavaDoc for the connector. (To learn more about JavaDoc annotations for DevKit, see <a href="creating-reference-documentation.html">Creating Reference Documentation</a>.)</p>
</div>
<div class="paragraph">
<p>In the <code>@Connector</code> class source code, the following comment links the method to its required XML sample:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{@<code>sample.xml ../../../doc/rest-jersey-connector.xml.sample rest-jersey:get-account-info</code>}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will see the sample code snippets file in the <code>doc</code> folder inside the DevKit generated project.</p>
</div>
<div class="paragraph">
<p>DevKit created this file, but we need to populate it with example Mule XML configurations for each operation. For this example, add the following to the file to document the operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;!-- BEGIN_INCLUDE(rest-jersey:get-account-info) --&gt;
    &lt;rest-jersey:get-account-info /&gt;
&lt;!-- END_INCLUDE(rest-jersey:get-account-info) --&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you build the JavaDoc, the sample above is inserted into the documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="manually-testing-your-connector"><a class="anchor" href="#manually-testing-your-connector"></a>Manually Testing Your Connector</h3>
<div class="paragraph">
<p>Once you have completed all of the steps above, you are ready to build and test your connector manually in Studio. See <a href="installing-and-testing-your-connector-in-studio.html">Installing and Testing Your Connector</a> for the steps to follow to build your connector and import it into Studio.</p>
</div>
<div class="paragraph">
<p>DevKit does not force you to add unit tests for your connector, though as noted earlier, this is strongly recommended. If you have added unit tests that your connector does not pass, then your Maven builds fail. You can temporarily bypass your unit tests by  adding the argument <code>-Dmaven.test.skip=true</code> to your Maven command. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">mvn clean install -Dmaven.test.skip=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have imported your connector into Studio, you will see it in the palette, and you can use it in flows. The Properties Editor shows your operations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./_images/rest-jersey-operation.png" alt="rest jersey operation">
</div>
</div>
<div class="paragraph">
<p>Note the Authorize and Unauthorize operations that are added automatically by DevKit to any OAuth connector.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps"><a class="anchor" href="#next-steps"></a>Next Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Congratulations! You have a connector that works well enough to install in Studio and to pass basic unit tests. Now you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Continue to add operations through the iterative process described above, until you have your desired operations and test cases to validate all desired behaviors.</p>
</li>
<li>
<p>Add tests to your test suite as described in <a href="developing-devkit-connector-tests.html">Developing DevKit Connector Tests</a>.</p>
</li>
<li>
<p>Refine the appearance of the connector dialog boxes and XML element, as described in <a href="defining-connector-attributes.html#customizing-attributes-look-and-feel">Defining Connector Attributes - Customizing Attributes look and feel</a>.</p>
</li>
<li>
<p>You can also return to the <a href="anypoint-connector-development.html">Anypoint Connector Development</a>.</p>
</li>
</ul>
</div>
</div>
</div>
  </article>
</main>
<footer class="footer"><div class="footer__wrapper">
      <div class="footer__top">
              </div>
      <div class="footer-bottom-wrapper">
        <!--<a href="/" title="Home" rel="home" class="header__logo" id="logo"><img src="/sites/all/themes/muletheme/images/mule_logo.svg" alt="Home" class="header__logo-image" /></a>-->
        <div class="connect-footer">
          <p>Sign up for our Dev newsletter</p>
          <div class="connect-footer">

</div>
  </div>
        <div class="terms-conditions temp">
          <div id="block-menu-menu-footer-bottom-menu" class="block block-menu contextual-links-region first last odd" role="navigation">
            <ul class="menu"><li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/" class="menu__link">MuleSoft.com</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://blogs.mulesoft.com/" class="menu__link">Blog</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/content/terms-service" class="menu__link">Terms</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/privacy-policy" class="menu__link">Privacy</a></li>
              <li class="menu__item is-leaf leaf"><a href="https://www.mulesoft.com/contact" class="menu__link">Contact</a></li>
            </ul></div>
                    <div class="default-terms-conditions">
          </div>
          MuleSoft provides a widely used <a href="https://www.mulesoft.com/platform/enterprise-integration">integration platform</a> for connecting SaaS and enterprise applications in the cloud and on-premise. Delivered as a unified integration experience, <a href="https://www.mulesoft.com/platform/saas/cloudhub-ipaas-cloud-based-integration">CloudHub&trade;</a> and <a href="https://www.mulesoft.com/platform/soa/mule-esb-open-source-esb">Mule ESB&trade;</a> (Enterprise Service Bus) are built on proven open source technology for fast and reliable on-premise and cloud integration without vendor lock-in.


        </div>
      </div>
      <div class="footer-end">
        <div class="footer-logo-wrapper">
          <a href="https://developer.mulesoft.com/" class="footer-logo"></a>
        </div>
        <ul class="social-links"><li><a href="https://www.mulesoft.com/lp/contact" target="_blank" class="icon-muletheme-phone"></a></li>
          <li><a href="https://www.linkedin.com/company/mulesoft" target="_blank" class="icon-muletheme-linkedin"></a></li>
          <li><a href="https://twitter.com/muledev" target="_blank" class="icon-muletheme-twitter"></a></li>
          <li><a href="https://www.facebook.com/MuleSoft" target="_blank" class="icon-muletheme-facebook"></a></li>
          <li><a href="mailto:info@mulesoft.com" target="_blank" class="icon-muletheme-email"></a></li>
          <li><a href="https://videos.mulesoft.com/" target="_blank" class="icon-muletheme-youtube"></a></li>
        </ul><p class="copyright"><span>&copy;2017</span> MuleSoft, INC.</p>
      </div>
    </div>
    </footer><script src="../../_theme/scripts/menu.js"></script>
<script src="../../_theme/scripts/highlight.pack.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>
